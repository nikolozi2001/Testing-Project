<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Fetch Example</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        #data-container {
            margin-top: 20px;
            width: 100%;
            max-width: 600px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            background-color: #f9f9f9;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .loading {
            display: none;
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            color: #007bff;
        }
    </style>
</head>

<body>
    <h1>API Fetch Example</h1>
    <div class="container">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="card">
                    <div class="card-body">
                        <div class="form-group">
                            <label for="year-select">Select Year:</label>
                            <select id="year-select" class="form-control">
                                <option value="" disabled selected>Select a year</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="api-select">Select API:</label>
                            <select id="api-select" class="form-control">
                                <option value="" disabled selected>Select an API</option>
                                <option value="api2">ბრუნვა</option>
                                <option value="api1">დამატებული ღირებულება</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loading" class="loading">Loading...</div>
    <div id="data-container" class="container mt-4">
        <ul id="data-list"></ul>
    </div>

    <script>
        // Generate year options dynamically
        function generateYearOptions() {
            const yearSelect = document.getElementById("year-select");
            const startYear = 2006;
            const endYear = 2022;

            for (let year = startYear; year <= endYear; year++) {
                const option = document.createElement("option");
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        // Generate year options on page load
        generateYearOptions();

        const yearSelect = document.getElementById("year-select");
        const apiSelect = document.getElementById("api-select");
        const dataContainer = document.getElementById("data-container");
        const loading = document.getElementById("loading");

        function fetchData() {
            const year = yearSelect.value;
            const apiChoice = apiSelect.value;

            if (!year || !apiChoice) {
                Toastify({
                    text: "Please select both Year and API.",
                    duration: 3000,
                    gravity: "top", // `top` or `bottom`
                    position: "right", // `left`, `center` or `right`
                    backgroundColor: "#FF0000",
                    stopOnFocus: true, // Prevents dismissing of toast on hover
                }).showToast();
                return;
            }

            let apiUrl = "";
            if (apiChoice === "api1") {
                apiUrl = `http://192.168.1.27:3001/api/getValAdded?year=${year}`;
            } else if (apiChoice === "api2") {
                apiUrl = `http://192.168.1.27:3001/api/getRegBrunva?year=${year}`;
            }

            console.log("Fetching data from:", apiUrl);

            // Show loading
            loading.style.display = "block";
            dataContainer.innerHTML = "<ul id='data-list'></ul>"; // Ensure list exists

            axios.get(apiUrl)
                .then((response) => {
                    console.log("API Response:", response.data);
                    const dataList = document.getElementById("data-list");

                    if (!dataList) {
                        console.error("data-list element not found!");
                        return;
                    }

                    dataList.innerHTML = ""; // Clear previous data

                    if (response.data.length === 0) {
                        dataList.innerHTML = "<li>No data available for this selection.</li>";
                        return;
                    }

                    response.data.forEach(item => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = apiChoice === "api1"
                            ? `<strong>Region ID:</strong> ${item.region_id}<br>
                               <strong>Name (GE):</strong> ${item.name_ge}<br>
                               <strong>Name (EN):</strong> ${item.name_en}<br>
                               <strong>W ${year}:</strong> ${item[`w_${year}`]}<br>`
                            : `<strong>Region ID:</strong> ${item.region_id}<br>
                               <strong>Name (GE):</strong> ${item.name_ge}<br>
                               <strong>Name (EN):</strong> ${item.name_en}<br>
                               <strong>W ${year}:</strong> ${item[`w_${year}`]}<br>`;
                        dataList.appendChild(listItem);
                    });
                })
                .catch((error) => {
                    console.error("Error fetching data:", error);
                    Toastify({
                        text: "Error fetching data. Please check the Year.",
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: "#FF0000",
                        stopOnFocus: true,
                    }).showToast();
                })
                .finally(() => {
                    loading.style.display = "none";
                });
        }

        // Trigger fetch when both selects are chosen
        yearSelect.addEventListener("change", fetchData);
        apiSelect.addEventListener("change", fetchData);
    </script>

</body>

</html>